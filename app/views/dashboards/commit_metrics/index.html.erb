<div class="bg-white p-6 rounded-lg shadow-md">
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-4">Commit Metrics Dashboard</h1>
    
    <!-- Filters -->
    <div class="bg-gray-50 p-4 rounded-lg mb-6">
      <%= form_with url: dashboards_commit_metrics_path, method: :get, class: "flex flex-wrap items-center gap-4" do %>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Time Period</label>
          <%= select_tag :period, 
            options_for_select([
              ['Last Week', 'week'], 
              ['Last Month', 'month'], 
              ['Last Quarter', 'quarter'], 
              ['Last Year', 'year']
            ], @period),
            class: "rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Repository</label>
          <%= select_tag :repository, 
            options_for_select([['All Repositories', '']] + @repositories.map { |repo| [repo, repo] }, @repository),
            class: "rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
        </div>
        
        <div class="self-end">
          <%= submit_tag "Apply Filters", class: "px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700" %>
        </div>
      <% end %>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Commit Type Distribution -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h2 class="text-lg font-medium text-gray-800 mb-3">Commit Type Distribution</h2>
        <% if @commit_types.present? %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Percentage</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% total = @commit_types.sum(&:count) %>
                <% @commit_types.each do |type| %>
                  <tr>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= type.commit_type %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= type.count %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= number_to_percentage((type.count.to_f / total) * 100, precision: 1) %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-gray-500 italic">No commit type data available</p>
        <% end %>
      </div>
      
      <!-- Directory Hotspots -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h2 class="text-lg font-medium text-gray-800 mb-3">Directory Hotspots</h2>
        <% if @hotspot_directories.present? %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Directory</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Changes</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% @hotspot_directories.each do |dir| %>
                  <tr>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= dir.directory %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= dir.change_count %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-gray-500 italic">No directory hotspot data available</p>
        <% end %>
      </div>
      
      <!-- File Type Hotspots -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h2 class="text-lg font-medium text-gray-800 mb-3">File Type Changes</h2>
        <% if @hotspot_filetypes.present? %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">File Type</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Changes</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% @hotspot_filetypes.each do |type| %>
                  <tr>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= type.filetype %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= type.change_count %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-gray-500 italic">No file type data available</p>
        <% end %>
      </div>
      
      <!-- Author Activity -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h2 class="text-lg font-medium text-gray-800 mb-3">Top Contributors</h2>
        <% if @top_authors.present? %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Author</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Commits</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% @top_authors.each do |author| %>
                  <tr>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= author.author %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= author.commit_count %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-gray-500 italic">No author data available</p>
        <% end %>
      </div>
      
      <!-- Lines Changed by Author -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h2 class="text-lg font-medium text-gray-800 mb-3">Code Volume by Author</h2>
        <% if @lines_by_author.present? %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Author</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Added</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deleted</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% @lines_by_author.each do |author| %>
                  <tr>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= author.author %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap text-green-600">
                      +<%= author.lines_added %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap text-red-600">
                      -<%= author.lines_deleted %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= author.lines_added.to_i + author.lines_deleted.to_i %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-gray-500 italic">No code volume data available</p>
        <% end %>
      </div>
      
      <!-- Breaking Changes -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h2 class="text-lg font-medium text-gray-800 mb-3">Breaking Changes</h2>
        <% if @breaking_changes.present? %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Author</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Breaking Changes</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% @breaking_changes.each do |author| %>
                  <tr>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= author.author %>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                      <%= author.breaking_count %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-gray-500 italic">No breaking changes data available</p>
        <% end %>
      </div>
    </div>
  </div>
</div> 